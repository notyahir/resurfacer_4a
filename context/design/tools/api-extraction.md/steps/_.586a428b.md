---
timestamp: 'Mon Nov 03 2025 18:10:00 GMT-0500 (Eastern Standard Time)'
parent: '[[../20251103_181000.53a689e3.md]]'
content_id: 586a428bb5396585044b3d7570b23abcbed787961bd9fadc81019bcb375c512c
---

# Extracted App API

This document outlines the API for the application, derived from the five core concepts: `PlatformLink`, `LibraryCache`, `TrackScoring`, `SwipeSessions`, and `PlaylistHealth`. Each concept exposes a set of actions and queries that can be called with a single dictionary argument and return a single dictionary result.

***

## `PlatformLink` Concept API

Provides authenticated access to streaming platforms, managing links and capabilities for users.

### Actions

* **`link`**
  * **Description**: Creates a new link to a streaming platform for a given user.
  * **Parameters**: `{ userId: string, platform: string }`
  * **Returns**: `{ linkId: string }` on success, or `{ error: string }` on failure.

* **`refresh`**
  * **Description**: Refreshes the access token for an existing platform link, extending its expiration.
  * **Parameters**: `{ linkId: string }`
  * **Returns**: `{ newExpiration: number }` on success, or `{ error: string }` on failure.

* **`revoke`**
  * **Description**: Revokes a user's link to a platform, deleting the link and all associated capabilities.
  * **Parameters**: `{ linkId: string }`
  * **Returns**: `{ removed: boolean }` on success, or `{ error: string }` on failure.

* **`can`**
  * **Description**: Checks if a link is active (token not expired) and possesses a specific capability.
  * **Parameters**: `{ linkId: string, capability: string }`
  * **Returns**: `{ ok: boolean }` indicating if the link has the capability and is active.

* **`listLinks`**
  * **Description**: Lists all platform links associated with a given user.
  * **Parameters**: `{ userId: string }`
  * **Returns**: `{ links: Array<{ linkId: string, platform: string, tokenExpiration: number }> }` on success, or `{ error: string }` on failure.

* **`syncLibrary`**
  * **Description**: Accepts a library payload (tracks, likes, plays, playlists) and syncs it into the `LibraryCache` concept on behalf of the user associated with the link.
  * **Parameters**: `{ linkId: string, payload: { userId: string, tracks: Array<{...}>, likes: Array<{...}>, plays: Array<{...}>, playlists: Array<{...}> } }`
  * **Returns**: `{ synced: boolean }` on success, or `{ error: string }` on failure.

* **`bootstrapTrackScoring`**
  * **Description**: A convenience method to ingest stats from `LibraryCache` into `TrackScoring` and prime the scores for a user.
  * **Parameters**: `{ userId: string, size?: number }`
  * **Returns**: `{ ingested: number, ensuredWeights: boolean, previewCount: number, source: string }` on success, or `{ error: string }` on failure.

***

## `LibraryCache` Concept API

Maintains a local snapshot of a userâ€™s streaming library, including tracks, likes, plays, and playlists.

### Actions

* **`ingest`**
  * **Description**: Populates the cache with a user's complete library data. This is an alias for `sync`.
  * **Parameters**: `{ userId: string, tracks: Array<{...}>, likes: Array<{...}>, plays: Array<{...}>, playlists: Array<{...}> }`
  * **Returns**: `{}` on success, or `{ error: string }` on failure.

* **`sync`**
  * **Description**: Performs a full replacement sync of a user's library data, updating track metadata and replacing likes, plays, and playlists.
  * **Parameters**: `{ userId: string, tracks: Array<{...}>, likes: Array<{...}>, plays: Array<{...}>, playlists: Array<{...}> }`
  * **Returns**: `{}` on success, or `{ error: string }` on failure.

### Queries

* **`_getLiked`**
  * **Description**: Returns a list of track IDs for a user's liked tracks, sorted by most recently added.
  * **Parameters**: `{ userId: string }`
  * **Returns**: An array containing a single object: `[{ trackIds: string[] }]` on success, or `[{ error: string }]` on failure.

* **`_getPlaylist`**
  * **Description**: Returns an ordered list of track IDs for a given playlist.
  * **Parameters**: `{ playlistId: string }`
  * **Returns**: An array containing a single object: `[{ entries: string[] }]` on success, or `[{ error: string }]` on failure.

***

## `TrackScoring` Concept API

Computes a "staleness" score for each track in a user's library and manages user-driven boosts and snoozes.

### Actions

* **`updateWeights`**
  * **Description**: Updates the scoring weights used to calculate staleness for a given user.
  * **Parameters**: `{ userId: string, lastPlayedW: number, likedWhenW: number, timesSkippedW: number }`
  * **Returns**: `{}` on success, or `{ error: string }` on failure.

* **`updateStats`**
  * **Description**: Updates the playback statistics (e.g., last played, times skipped) for a specific user-track pair.
  * **Parameters**: `{ userId: string, trackId: string, lastPlayedAt: number, likedAt: number, timesSkipped: number }`
  * **Returns**: `{}` on success, or `{ error: string }` on failure.

* **`score`**
  * **Description**: Computes, stores, and returns the staleness score (0-100) for a given track based on the user's weights and the track's stats.
  * **Parameters**: `{ userId: string, trackId: string }`
  * **Returns**: `{ score: number }` on success, or `{ error: string }` on failure.

* **`preview`**
  * **Description**: Returns a list of track recommendations for a user, sorted by their staleness score in descending order.
  * **Parameters**: `{ userId: string, size?: number }` (size defaults to 50).
  * **Returns**: `{ trackIds: string[], tracks: Array<{...}>, source: "scores" | "bootstrap" | "empty" }` on success, or `{ error: string }` on failure.

* **`keep`**
  * **Description**: Increases a track's "boost," making it more likely to appear in future previews.
  * **Parameters**: `{ userId: string, trackId: string }`
  * **Returns**: `{}` on success, or `{ error: string }` on failure.

* **`snooze`**
  * **Description**: Snoozes a track for a user, preventing it from appearing in previews for a specified duration.
  * **Parameters**: `{ userId: string, trackId: string, until?: number }` (duration in ms, defaults to 7 days).
  * **Returns**: `{}` on success, or `{ error: string }` on failure.

* **`ingestFromLibraryCache`**
  * **Description**: Populates the initial `Stats` for a user by pulling data from the `LibraryCache` concept.
  * **Parameters**: `{ userId: string }`
  * **Returns**: `{ ingested: number, ensuredWeights: boolean }` on success, or `{ error: string }` on failure.

***

## `SwipeSessions` Concept API

Manages "swipe session" workflows where a user makes rapid decisions on a queue of tracks.

### Actions

* **`start`**
  * **Description**: Creates a new swipe session for a user with a given queue of tracks.
  * **Parameters**: `{ userId: string, queueTracks: string[], size?: number }`
  * **Returns**: `{ sessionId: string }` on success, or `{ error: string }` on failure.

* **`next`**
  * **Description**: Retrieves the next track from the session's queue and advances the cursor.
  * **Parameters**: `{ sessionId: string }`
  * **Returns**: `{ trackId: string }`. Returns `{ trackId: "-1" }` if the queue is finished. Returns `{ error: string }` on failure.

* **`decideKeep`**
  * **Description**: Records a "keep" decision for the current track in the session.
  * **Parameters**: `{ sessionId: string, trackId: string }`
  * **Returns**: `{ decisionId: string }` on success, or `{ error: string }` on failure.

* **`decideSnooze`**
  * **Description**: Records a "snooze" decision for the current track in the session.
  * **Parameters**: `{ sessionId: string, trackId: string, untilAt?: number }`
  * **Returns**: `{ decisionId: string }` on success, or `{ error: string }` on failure.

* **`decideAddToPlaylist`**
  * **Description**: Records a decision to add the current track to an existing playlist.
  * **Parameters**: `{ sessionId: string, trackId: string, playlistId: string }`
  * **Returns**: `{ decisionId: string }` on success, or `{ error: string }` on failure.

* **`decideCreatePlaylist`**
  * **Description**: Records a decision to create a new playlist with the current track.
  * **Parameters**: `{ sessionId: string, trackId: string, playlistTitle: string }`
  * **Returns**: `{ decisionId: string }` on success, or `{ error: string }` on failure.

* **`end`**
  * **Description**: Ends and deletes a swipe session.
  * **Parameters**: `{ sessionId: string }`
  * **Returns**: `{ ended: boolean }` indicating if the session was successfully deleted.

***

## `PlaylistHealth` Concept API

Analyzes snapshots of playlists to detect issues like duplicate tracks, unavailable tracks, and outliers.

### Actions

* **`snapshot`**
  * **Description**: Creates and stores a snapshot of a playlist's current track list.
  * **Parameters**: `{ playlistId: string, userId: string, trackIds: string[] }`
  * **Returns**: `{ snapshotId: string }` on success, or `{ error: string }` on failure.

* **`analyze`**
  * **Description**: Analyzes a stored snapshot to find issues and generates a health report.
  * **Parameters**: `{ playlistId: string, snapshotId: string }`
  * **Returns**: `{ reportId: string }` on success, or `{ error: string }` on failure.

* **`getReport`**
  * **Description**: Retrieves a previously generated playlist health report.
  * **Parameters**: `{ reportId: string }`
  * **Returns**: `{ playlistId: string, snapshotId: string, findings: Array<{ idx: number, trackId: string, kind: string }> }` on success, or `{ error: string }` on failure.
