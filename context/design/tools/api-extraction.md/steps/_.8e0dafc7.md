---
timestamp: 'Tue Oct 21 2025 15:04:27 GMT-0400 (Eastern Daylight Time)'
parent: '[[../20251021_150427.0eab3e5e.md]]'
content_id: 8e0dafc78e499ddf79d6ee13c6f3b520cc67d6dc3872a5bba16941b2a9df3cad
---

# Application API

This document outlines the API endpoints derived from the application's concepts. Each action is a method that takes a single JSON object as input and returns a single JSON object as output. Queries are prefixed with an underscore (`_`).

## `PlatformLink`

**Purpose**: Provide authenticated access to a streaming platform. Gives other concepts a safe way of talking to the streaming platform without leaking tokens.

### Actions

#### `link`

Creates a new link to a streaming platform for a given user.

* **Input**:
  ```json
  {
    "userId": "string (ID)",
    "platform": "string"
  }
  ```
* **Output (Success)**:
  ```json
  {
    "linkId": "string (ID)"
  }
  ```
* **Output (Error)**:
  ```json
  {
    "error": "string"
  }
  ```

#### `refresh`

Refreshes the access token for an existing link, prolonging its expiration.

* **Input**:
  ```json
  {
    "linkId": "string (ID)"
  }
  ```
* **Output (Success)**:
  ```json
  {
    "newExpiration": "number (timestamp)"
  }
  ```
* **Output (Error)**:
  ```json
  {
    "error": "string"
  }
  ```

#### `revoke`

Revokes a user's link to a platform, deleting the link and associated tokens.

* **Input**:
  ```json
  {
    "linkId": "string (ID)"
  }
  ```
* **Output (Success)**:
  ```json
  {
    "removed": "boolean"
  }
  ```
* **Output (Error)**:
  ```json
  {
    "error": "string"
  }
  ```

#### `can`

Checks if a link is active (token not expired) and possesses a specific capability.

* **Input**:
  ```json
  {
    "linkId": "string (ID)",
    "capability": "string"
  }
  ```
* **Output**:
  ```json
  {
    "ok": "boolean"
  }
  ```

## `LibraryCache`

**Purpose**: Keep a local, queryable snapshot of a userâ€™s liked tracks, plays, and playlists for analysis and tooling.

### Actions

#### `ingest` / `sync`

Populates or updates the local cache with a user's library data. This is a full replacement operation for the user's likes, plays, and playlists. `ingest` is an alias for `sync`.

* **Input**:
  ```json
  {
    "userId": "string (ID)",
    "tracks": [
      {
        "trackId": "string",
        "title": "string",
        "artist": "string",
        "available": "boolean",
        "tempo": "number (optional)",
        "energy": "number (optional)",
        "valence": "number (optional)"
      }
    ],
    "likes": [
      {
        "trackId": "string",
        "addedAt": "number (timestamp)"
      }
    ],
    "plays": [
      {
        "trackId": "string",
        "lastPlayedAt": "number (timestamp)"
      }
    ],
    "playlists": [
      {
        "playlistId": "string",
        "entries": [
          { "idx": "number", "trackId": "string" }
        ],
        "updatedAt": "number (timestamp)"
      }
    ]
  }
  ```
* **Output (Success)**:
  ```json
  {}
  ```
* **Output (Error)**:
  ```json
  {
    "error": "string"
  }
  ```

### Queries

#### `_getLiked`

Returns a list of track IDs for a user's liked tracks, sorted by most recently added.

* **Input**:
  ```json
  {
    "userId": "string (ID)"
  }
  ```
* **Output (Success)**:
  ```json
  {
    "trackIds": ["string", "..."]
  }
  ```
* **Output (Error)**:
  ```json
  {
    "error": "string"
  }
  ```

#### `_getPlaylist`

Returns an ordered list of track IDs for a given playlist.

* **Input**:
  ```json
  {
    "playlistId": "string"
  }
  ```
* **Output (Success)**:
  ```json
  {
    "entries": ["string", "..."]
  }
  ```
* **Output (Error)**:
  ```json
  {
    "error": "string"
  }
  ```

## `TrackScoring`

**Purpose**: Compute a staleness score for each track in a user's liked song catalog and manage boosts/snoozes for resurfacing.

### Actions

#### `updateWeights`

Updates the scoring weights for a given user.

* **Input**:
  ```json
  {
    "userId": "string (ID)",
    "lastPlayedW": "number",
    "likedWhenW": "number",
    "timesSkippedW": "number"
  }
  ```
* **Output (Success)**:
  ```json
  {}
  ```
* **Output (Error)**:
  ```json
  {
    "error": "string"
  }
  ```

#### `updateStats`

Updates the playback statistics for a user-track pair.

* **Input**:
  ```json
  {
    "userId": "string (ID)",
    "trackId": "string (ID)",
    "lastPlayedAt": "number (timestamp)",
    "likedAt": "number (timestamp)",
    "timesSkipped": "number"
  }
  ```
* **Output (Success)**:
  ```json
  {}
  ```
* **Output (Error)**:
  ```json
  {
    "error": "string"
  }
  ```

#### `score`

Computes, stores, and returns a staleness score for a given track based on the user's weights and the track's stats.

* **Input**:
  ```json
  {
    "userId": "string (ID)",
    "trackId": "string (ID)"
  }
  ```
* **Output (Success)**:
  ```json
  {
    "score": "number"
  }
  ```
* **Output (Error)**:
  ```json
  {
    "error": "string"
  }
  ```

#### `preview`

Returns a list of track IDs for a user, sorted by score in descending order.

* **Input**:
  ```json
  {
    "userId": "string (ID)",
    "size": "number (optional, default: 50)"
  }
  ```
* **Output (Success)**:
  ```json
  {
    "trackIds": ["string (ID)", "..."]
  }
  ```
* **Output (Error)**:
  ```json
  {
    "error": "string"
  }
  ```

#### `keep`

Increases the boost for a track, making it more likely to be resurfaced.

* **Input**:
  ```json
  {
    "userId": "string (ID)",
    "trackId": "string (ID)"
  }
  ```
* **Output (Success)**:
  ```json
  {}
  ```
* **Output (Error)**:
  ```json
  {
    "error": "string"
  }
  ```

#### `snooze`

Snoozes a track for a user, preventing it from being resurfaced for a period of time.

* **Input**:
  ```json
  {
    "userId": "string (ID)",
    "trackId": "string (ID)",
    "until": "number (duration in ms, optional)"
  }
  ```
* **Output (Success)**:
  ```json
  {}
  ```
* **Output (Error)**:
  ```json
  {
    "error": "string"
  }
  ```

## `SwipeSessions`

**Purpose**: Run deterministic swipe sessions over a queued set of tracks and record user decisions locally.

### Actions

#### `start`

Starts a new swipe session for a user with a given queue of tracks.

* **Input**:
  ```json
  {
    "userId": "string (ID)",
    "queueTracks": ["string", "..."],
    "size": "number (optional)"
  }
  ```
* **Output (Success)**:
  ```json
  {
    "sessionId": "string (ID)"
  }
  ```
* **Output (Error)**:
  ```json
  {
    "error": "string"
  }
  ```

#### `next`

Retrieves the next track in the session's queue and advances the cursor.

* **Input**:
  ```json
  {
    "sessionId": "string (ID)"
  }
  ```
* **Output (Success)**:
  ```json
  {
    "trackId": "string"
  }
  ```
  *Note: `trackId` will be `"-1"` when the queue is finished.*
* **Output (Error)**:
  ```json
  {
    "error": "string"
  }
  ```

#### `decideKeep`

Records a 'keep' decision for the current track in a session.

* **Input**:
  ```json
  {
    "sessionId": "string (ID)",
    "trackId": "string"
  }
  ```
* **Output (Success)**:
  ```json
  {
    "decisionId": "string (ID)"
  }
  ```
* **Output (Error)**:
  ```json
  {
    "error": "string"
  }
  ```

#### `decideSnooze`

Records a 'snooze' decision for the current track in a session.

* **Input**:
  ```json
  {
    "sessionId": "string (ID)",
    "trackId": "string",
    "untilAt": "number (timestamp, optional)"
  }
  ```
* **Output (Success)**:
  ```json
  {
    "decisionId": "string (ID)"
  }
  ```
* **Output (Error)**:
  ```json
  {
    "error": "string"
  }
  ```

#### `decideAddToPlaylist`

Records a decision to add the current track to an existing playlist.

* **Input**:
  ```json
  {
    "sessionId": "string (ID)",
    "trackId": "string",
    "playlistId": "string"
  }
  ```
* **Output (Success)**:
  ```json
  {
    "decisionId": "string (ID)"
  }
  ```
* **Output (Error)**:
  ```json
  {
    "error": "string"
  }
  ```

#### `decideCreatePlaylist`

Records a decision to create a new playlist with the current track.

* **Input**:
  ```json
  {
    "sessionId": "string (ID)",
    "trackId": "string",
    "playlistTitle": "string"
  }
  ```
* **Output (Success)**:
  ```json
  {
    "decisionId": "string (ID)"
  }
  ```
* **Output (Error)**:
  ```json
  {
    "error": "string"
  }
  ```

#### `end`

Ends a session, deleting its record.

* **Input**:
  ```json
  {
    "sessionId": "string (ID)"
  }
  ```
* **Output**:
  ```json
  {
    "ended": "boolean"
  }
  ```

## `PlaylistHealth`

**Purpose**: Detect duplicates, unavailable tracks, and feature outliers in a playlist from a provided snapshot.

### Actions

#### `snapshot`

Creates and stores a snapshot of a playlist's tracks at a specific moment.

* **Input**:
  ```json
  {
    "playlistId": "string (ID)",
    "userId": "string (ID)",
    "trackIds": ["string (ID)", "..."]
  }
  ```
* **Output (Success)**:
  ```json
  {
    "snapshotId": "string (ID)"
  }
  ```
* **Output (Error)**:
  ```json
  {
    "error": "string"
  }
  ```

#### `analyze`

Analyzes a given snapshot to find issues like duplicates, unavailable tracks, and outliers.

* **Input**:
  ```json
  {
    "playlistId": "string (ID)",
    "snapshotId": "string (ID)"
  }
  ```
* **Output (Success)**:
  ```json
  {
    "reportId": "string (ID)"
  }
  ```
* **Output (Error)**:
  ```json
  {
    "error": "string"
  }
  ```

#### `getReport`

Retrieves the results of a previously generated playlist health report.

* **Input**:
  ```json
  {
    "reportId": "string (ID)"
  }
  ```
* **Output (Success)**:
  ```json
  {
    "playlistId": "string (ID)",
    "snapshotId": "string (ID)",
    "findings": [
      {
        "idx": "number",
        "trackId": "string (ID)",
        "kind": "'Duplicate' | 'Unavailable' | 'Outlier'"
      }
    ]
  }
  ```
* **Output (Error)**:
  ```json
  {
    "error": "string"
  }
  ```
